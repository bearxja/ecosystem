



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.5.1">
    
    
      
        <title>1.7.1 C80 - FusionData Ecosystem</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#connection-instruction-between-apache-nifi-and-fusioninsight" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="FusionData Ecosystem" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              FusionData Ecosystem
            </span>
            <span class="md-header-nav__topic">
              
                1.7.1 <--> C80
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/fusioninsight/ecosystem/tree/en/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    fusioninsight/ecosystem
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="FusionData Ecosystem" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    FusionData Ecosystem
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/fusioninsight/ecosystem/tree/en/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    fusioninsight/ecosystem
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Business Intelligence
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Business Intelligence
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-1" type="checkbox" id="nav-1-1">
    
    <label class="md-nav__link" for="nav-1-1">
      QlikView
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-1">
        QlikView
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Business_Intelligence/QlikView/" title="12 C60" class="md-nav__link">
      12 <--> C60
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Business_Intelligence/QlikView/" title="12 C70" class="md-nav__link">
      12 <--> C70
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Business_Intelligence/QlikView/" title="12 C80" class="md-nav__link">
      12 <--> C80
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2" type="checkbox" id="nav-1-2">
    
    <label class="md-nav__link" for="nav-1-2">
      SSRS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-2">
        SSRS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Business_Intelligence/SSRS/" title="2017 6.5" class="md-nav__link">
      2017 <--> 6.5
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-3" type="checkbox" id="nav-1-3">
    
    <label class="md-nav__link" for="nav-1-3">
      Tableau
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-3">
        Tableau
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Business_Intelligence/Tableau/" title="10.0.0 C50" class="md-nav__link">
      10.0.0 <--> C50
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Business_Intelligence/Tableau/" title="10.1.4 C60" class="md-nav__link">
      10.1.4 <--> C60
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Business_Intelligence/Tableau/" title="10.3.2 C70" class="md-nav__link">
      10.3.2 <--> C70
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Business_Intelligence/Tableau/" title="10.5.0 C80" class="md-nav__link">
      10.5.0 <--> C80
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Data Analysis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Data Analysis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      Rapidminer Studio
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        Rapidminer Studio
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Data_Analysis/RapidMiner/" title="8.2.001 C80" class="md-nav__link">
      8.2.001 <--> C80
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Data Integration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Data Integration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1" checked>
    
    <label class="md-nav__link" for="nav-3-1">
      Apache NiFi
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Apache NiFi
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        1.7.1 <--> C80
      </label>
    
    <a href="./" title="1.7.1 C80" class="md-nav__link md-nav__link--active">
      1.7.1 <--> C80
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#succeeded-case" class="md-nav__link">
    Succeeded Case
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-apache-nifi" class="md-nav__link">
    Installing Apache NiFi
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    Purpose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procedure" class="md-nav__link">
    Procedure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-kerberos-authentication-within-nifi" class="md-nav__link">
    Configuring Kerberos authentication within NiFi
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose_1" class="md-nav__link">
    Purpose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites_1" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procedure_1" class="md-nav__link">
    Procedure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-nifi-to-hdfs" class="md-nav__link">
    Connecting NiFi to HDFS
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose_2" class="md-nav__link">
    Purpose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites_2" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#puthdfs-procedure" class="md-nav__link">
    PutHDFS Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gethdfs-procedure" class="md-nav__link">
    GetHDFS Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listhdfs-fetchhdfs-procedure" class="md-nav__link">
    ListHDFS &amp; FetchHDFS Procedure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-nifi-to-hive" class="md-nav__link">
    Connecting NiFi to Hive
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose_3" class="md-nav__link">
    Purpose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites_3" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hiveconnectionpool-procedure" class="md-nav__link">
    HiveConnectionPool Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selecthiveql-read-hive-table-procedure" class="md-nav__link">
    SelectHiveQL read Hive table Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#puthiveql-load-whole-table-procedure" class="md-nav__link">
    PutHiveQL load whole table Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#puthiveql-load-the-table-by-rows-procedure" class="md-nav__link">
    PutHiveQL Load the table by rows Procedure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-nifi-to-hbase" class="md-nav__link">
    Connecting NiFi to HBase
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose_4" class="md-nav__link">
    Purpose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites_4" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbase_1_1_2_clientservice-procedure" class="md-nav__link">
    HBase_1_1_2_ClientService Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#puthbasejson-load-the-table-procedure" class="md-nav__link">
    PutHBaseJSON load the table Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gethbase-procedure" class="md-nav__link">
    GetHbase Procedure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-nifi-to-spark" class="md-nav__link">
    Connecting NiFi to Spark
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose_5" class="md-nav__link">
    Purpose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites_5" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#livysessioncontroller-procedure" class="md-nav__link">
    LivySessionController Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark-sample-procedure" class="md-nav__link">
    Spark Sample Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyspark-sample-procedure" class="md-nav__link">
    PySpark Sample Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sparkr-sample-procedure" class="md-nav__link">
    SparkR Sample Procedure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-nifi-to-kafka" class="md-nav__link">
    Connecting NiFi to Kafka
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose_6" class="md-nav__link">
    Purpose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites_6" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gethttp-putkafka-procedure" class="md-nav__link">
    GetHTTP &amp; PutKafka Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consumekafka_0_11-procedure" class="md-nav__link">
    ConsumeKafka_0_11 Procedure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-nifi-to-kafka-with-security-mode" class="md-nav__link">
    Connecting NiFi to Kafka with security mode
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose_7" class="md-nav__link">
    Purpose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites_7" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kerberos-authentication-related-operation-steps" class="md-nav__link">
    Kerberos authentication related operation steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publishkafka_1_0-sample" class="md-nav__link">
    PublishKafka_1_0 Sample
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consumekafka_1_0-sample" class="md-nav__link">
    ConsumeKafka_1_0 Sample
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nifi-connect-to-solr-with-security-mode" class="md-nav__link">
    NiFi connect to Solr with security mode
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-environmental-description" class="md-nav__link">
    Test environmental description
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fi-hd-related-configuration" class="md-nav__link">
    FI HD related configuration:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nifi-related-configuration" class="md-nav__link">
    NiFi related configuration:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssl-certificate-related-configuration" class="md-nav__link">
    SSL certificate related configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nifi-putsolrcontentstream-standard-mode-configuration" class="md-nav__link">
    NiFi PutSolrContentStream STANDARD mode Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nifi-putsolrcontentstream-cloud-mode-configuration" class="md-nav__link">
    NiFi PutSolrContentStream CLOUD mode Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nifi-querysolr-configuration" class="md-nav__link">
    NIFI QuerySolr Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Informatica PowerCenter
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Informatica PowerCenter
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Informatica_PowerCenter/" title="10.2.0 6.5" class="md-nav__link">
      10.2.0 <--> 6.5
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      Informatica PowerexChange CDC
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        Informatica PowerexChange CDC
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Informatica_PWX_CDC/" title="10.2.0 6.5" class="md-nav__link">
      10.2.0 <--> 6.5
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      Talend
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        Talend
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Talend/" title="6.4.1 C80" class="md-nav__link">
      6.4.1 <--> C80
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Talend/" title="7.0.1 C80" class="md-nav__link">
      7.0.1 <--> C80
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      Jupyter Notebook
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        Jupyter Notebook
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Development/EN_JupyterNotebook_update/" title="5.7.8 C80" class="md-nav__link">
      5.7.8 <--> C80
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Development/EN_JupyterNotebook_update/" title="5.7.8 6.5" class="md-nav__link">
      5.7.8 <--> 6.5
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Other
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Other
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1">
    
    <label class="md-nav__link" for="nav-5-1">
      Apache Livy
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        Apache Livy
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Other/EN_Using_Livy0.6.0_with_FusionInsight_HD_6_5_1_update/" title="0.5.0 C80" class="md-nav__link">
      0.5.0 <--> C80
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Other/EN_Using_Livy0.6.0_with_FusionInsight_HD_6_5_1_update/" title="0.6.0 6.5" class="md-nav__link">
      0.6.0 <--> 6.5
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#succeeded-case" class="md-nav__link">
    Succeeded Case
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-apache-nifi" class="md-nav__link">
    Installing Apache NiFi
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    Purpose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procedure" class="md-nav__link">
    Procedure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-kerberos-authentication-within-nifi" class="md-nav__link">
    Configuring Kerberos authentication within NiFi
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose_1" class="md-nav__link">
    Purpose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites_1" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procedure_1" class="md-nav__link">
    Procedure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-nifi-to-hdfs" class="md-nav__link">
    Connecting NiFi to HDFS
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose_2" class="md-nav__link">
    Purpose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites_2" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#puthdfs-procedure" class="md-nav__link">
    PutHDFS Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gethdfs-procedure" class="md-nav__link">
    GetHDFS Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listhdfs-fetchhdfs-procedure" class="md-nav__link">
    ListHDFS &amp; FetchHDFS Procedure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-nifi-to-hive" class="md-nav__link">
    Connecting NiFi to Hive
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose_3" class="md-nav__link">
    Purpose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites_3" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hiveconnectionpool-procedure" class="md-nav__link">
    HiveConnectionPool Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#selecthiveql-read-hive-table-procedure" class="md-nav__link">
    SelectHiveQL read Hive table Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#puthiveql-load-whole-table-procedure" class="md-nav__link">
    PutHiveQL load whole table Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#puthiveql-load-the-table-by-rows-procedure" class="md-nav__link">
    PutHiveQL Load the table by rows Procedure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-nifi-to-hbase" class="md-nav__link">
    Connecting NiFi to HBase
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose_4" class="md-nav__link">
    Purpose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites_4" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbase_1_1_2_clientservice-procedure" class="md-nav__link">
    HBase_1_1_2_ClientService Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#puthbasejson-load-the-table-procedure" class="md-nav__link">
    PutHBaseJSON load the table Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gethbase-procedure" class="md-nav__link">
    GetHbase Procedure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-nifi-to-spark" class="md-nav__link">
    Connecting NiFi to Spark
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose_5" class="md-nav__link">
    Purpose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites_5" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#livysessioncontroller-procedure" class="md-nav__link">
    LivySessionController Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spark-sample-procedure" class="md-nav__link">
    Spark Sample Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyspark-sample-procedure" class="md-nav__link">
    PySpark Sample Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sparkr-sample-procedure" class="md-nav__link">
    SparkR Sample Procedure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-nifi-to-kafka" class="md-nav__link">
    Connecting NiFi to Kafka
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose_6" class="md-nav__link">
    Purpose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites_6" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gethttp-putkafka-procedure" class="md-nav__link">
    GetHTTP &amp; PutKafka Procedure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consumekafka_0_11-procedure" class="md-nav__link">
    ConsumeKafka_0_11 Procedure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connecting-nifi-to-kafka-with-security-mode" class="md-nav__link">
    Connecting NiFi to Kafka with security mode
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#purpose_7" class="md-nav__link">
    Purpose
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prerequisites_7" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kerberos-authentication-related-operation-steps" class="md-nav__link">
    Kerberos authentication related operation steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publishkafka_1_0-sample" class="md-nav__link">
    PublishKafka_1_0 Sample
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consumekafka_1_0-sample" class="md-nav__link">
    ConsumeKafka_1_0 Sample
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nifi-connect-to-solr-with-security-mode" class="md-nav__link">
    NiFi connect to Solr with security mode
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-environmental-description" class="md-nav__link">
    Test environmental description
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fi-hd-related-configuration" class="md-nav__link">
    FI HD related configuration:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nifi-related-configuration" class="md-nav__link">
    NiFi related configuration:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssl-certificate-related-configuration" class="md-nav__link">
    SSL certificate related configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nifi-putsolrcontentstream-standard-mode-configuration" class="md-nav__link">
    NiFi PutSolrContentStream STANDARD mode Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nifi-putsolrcontentstream-cloud-mode-configuration" class="md-nav__link">
    NiFi PutSolrContentStream CLOUD mode Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nifi-querysolr-configuration" class="md-nav__link">
    NIFI QuerySolr Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/fusioninsight/ecosystem/tree/en/edit/master/docs/Data_Integration/Apache_NiFi.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="connection-instruction-between-apache-nifi-and-fusioninsight">Connection Instruction between Apache NiFi and FusionInsight<a class="headerlink" href="#connection-instruction-between-apache-nifi-and-fusioninsight" title="Permanent link">&para;</a></h1>
<h2 id="succeeded-case">Succeeded Case<a class="headerlink" href="#succeeded-case" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Apache NiFi 1.7.1 &harr; FusionInsight HD V100R002C80SPC200 (HDFS/HBase/Hive/Spark/Kafka/Solr)</p>
</blockquote>
<h2 id="installing-apache-nifi">Installing Apache NiFi<a class="headerlink" href="#installing-apache-nifi" title="Permanent link">&para;</a></h2>
<h3 id="purpose">Purpose<a class="headerlink" href="#purpose" title="Permanent link">&para;</a></h3>
<p>Installing Apache NiFi 1.7.1</p>
<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>Installing FusionInsight HD cluster and its client completed</li>
</ul>
<h3 id="procedure">Procedure<a class="headerlink" href="#procedure" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Get JAVA_HOME configuration by execute <strong>source</strong> command on client side
  <div class="codehilite"><pre><span></span>source /opt/hadoopclient/bigdata_env
echo $JAVA_HOME
</pre></div>
  <img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912165818271.png" /></p>
</li>
<li>
<p>Download NiFi installation file from <code>https://nifi.apache.org/download.html</code>, move the file to client side by using tool <strong>WinSCP</strong> , execute command <code>unzip nifi-1.7.1-bin.zip</code> to unzip the installation file to the following directory <code>/usr/nifi/nifi-1.7.1</code></p>
</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912160728825.png" /></p>
<ul>
<li>
<p>Configure NiFi server IP address and port by execute following command <code>vi /usr/nifi/nifi-1.7.1/conf/nifi.properties</code> and adjust the propeties within the <strong>nifi.properties</strong> file</p>
<p><div class="codehilite"><pre><span></span>nifi.web.http.host=172.16.52.190
nifi.web.http.port=8085
</pre></div>
<img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912163428506.png" /></p>
</li>
<li>
<p>Start and Stop NiFi server
    <div class="codehilite"><pre><span></span>cd /usr/nifi/nifi-1.7.1
bin/nifi.sh start
bin/nifi.sh stop
</pre></div>
    <img alt="" src="../assets/Apache_NiFi/markdown-img-paste-2018091216532553.png" /></p>
</li>
<li>
<p>Start NiFi Server</p>
<p><code>bin/nifi.sh start</code></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912170131362.png" /></p>
</li>
</ul>
<h2 id="configuring-kerberos-authentication-within-nifi">Configuring Kerberos authentication within NiFi<a class="headerlink" href="#configuring-kerberos-authentication-within-nifi" title="Permanent link">&para;</a></h2>
<h3 id="purpose_1">Purpose<a class="headerlink" href="#purpose_1" title="Permanent link">&para;</a></h3>
<p>Configuring Kerberos authentication within NiFi server for the later connection usage</p>
<h3 id="prerequisites_1">Prerequisites<a class="headerlink" href="#prerequisites_1" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Installing Apache NiFi completed</p>
</li>
<li>
<p>Installing FusionInsight HD cluster and its client completed</p>
</li>
<li>
<p>Create a developuser for connection</p>
</li>
</ul>
<h3 id="procedure_1">Procedure<a class="headerlink" href="#procedure_1" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Download the required Kerberos authentication files <code>user.keytab</code> and <code>krb5.conf</code> from FusionInsight HD Manager site, save the files into the following directory <code>/opt/developuser</code></p>
</li>
<li>
<p>Configure Kerberos authentication  by execute following command <code>vi /usr/nifi/nifi-1.7.1/conf/nifi.properties</code> and adjust the propeties within the <strong>nifi.properties</strong> file</p>
<div class="codehilite"><pre><span></span>Detailed Configuration：
nifi.kerberos.krb5.file=/opt/developuser/krb5.conf
nifi.kerberos.service.principal=developuser
nifi.kerberos.service.keytab.location=/opt/developuser/user.keytab
</pre></div>

<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912171916975.png" /></p>
</li>
<li>
<p>Enter NiFi Web UI site, right click on canvas and click on <strong>Configure</strong> icon</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912174115953.png" /></p>
<p>Click on <strong>plus</strong> icon to add the service</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912174226784.png" /></p>
<p>Find <code>KeytabCredentialsService</code> and click <strong>ADD</strong></p>
</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-2018091217444348.png" /></p>
<div class="codehilite"><pre><span></span>Click on **gear** icon to configure

![](assets/Apache_NiFi/markdown-img-paste-20180912174747644.png)

![](assets/Apache_NiFi/markdown-img-paste-2018091217482271.png)

Click on **lightning** icon to enable and save the KeytabCredentialsService

![](assets/Apache_NiFi/markdown-img-paste-20180912174904147.png)

![](assets/Apache_NiFi/markdown-img-paste-20180912175037790.png)
</pre></div>


<ul>
<li>Completed
  <img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912175122322.png" /></li>
</ul>
<h2 id="connecting-nifi-to-hdfs">Connecting NiFi to HDFS<a class="headerlink" href="#connecting-nifi-to-hdfs" title="Permanent link">&para;</a></h2>
<h3 id="purpose_2">Purpose<a class="headerlink" href="#purpose_2" title="Permanent link">&para;</a></h3>
<p>Configuring NiFi related HDFS processor to connect FusionInsight HD HDFS</p>
<h3 id="prerequisites_2">Prerequisites<a class="headerlink" href="#prerequisites_2" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Installing NiFi 1.7.1 completed</p>
</li>
<li>
<p>Installing FusionInsight HD cluster and its client completed</p>
</li>
<li>
<p>Configuring Kerberos authentication within NiFi completed</p>
</li>
</ul>
<h3 id="puthdfs-procedure">PutHDFS Procedure<a class="headerlink" href="#puthdfs-procedure" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Find and Copy the <code>hdfs-site.xml</code>，<code>core-site.xml</code> files which located in FusionInsight HD client to the following directory <code>/usr/nifi/nifi-1.7.1/conf</code></p>
</li>
<li>
<p>Make an adjustment to the content of <code>hdfs-site.xml</code> that is to delete the following property
    <div class="codehilite"><pre><span></span>&lt;property&gt;
&lt;name&gt;dfs.client.failover.proxy.provider.hacluster&lt;/name&gt;
&lt;value&gt;org.apache.hadoop.hdfs.server.namenode.ha.BlackListingFailoverProxyProvider&lt;/value&gt;
&lt;/property&gt;
</pre></div></p>
</li>
<li>
<p>Make an adjustment to the content of <code>core-site.xml</code> that is to change <strong>halcluster</strong> into detailed namenode ip with its port</p>
<div class="codehilite"><pre><span></span>&lt;property&gt;
&lt;name&gt;fs.defaultFS&lt;/name&gt;
&lt;value&gt;hdfs://172.21.3.102:25000&lt;/value&gt;
&lt;/property&gt;
</pre></div>

</li>
<li>
<p>The whole process shown as the following pic:</p>
</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912172755668.png" /></p>
<ul>
<li>The configuration of processor <strong>GetFile</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912172954559.png" />
  <div class="codehilite"><pre><span></span>In detail：
1: /home/dataset
</pre></div></p>
<ul>
<li>The configuration of processor <strong>PutHDFS</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912181011524.png" /></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912175441819.png" />
  <div class="codehilite"><pre><span></span>In detail：
1: /usr/nifi/nifi-1.7.1/conf/hdfs-site.xml,/usr/nifi/nifi-1.7.1/conf/core-site.xml
2: Choose KeytabCredentialsService which was completed in previous section
3: /tmp/nifitest
</pre></div></p>
<ul>
<li>The configuration of the connection between two former processors</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912181110245.png" /></p>
<ul>
<li>Move the file <code>nifiHDFS.csv</code> into the following directory <code>/home/dataset</code> before test start</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-2018091218142008.png" /></p>
<p>Content of <code>nifiHDFS.csv</code>：
  <div class="codehilite"><pre><span></span>1;EcitQU
2;Hyy6RC
3;zju1jR
4;R9fex9
5;EU2mVq
</pre></div>
  - Test completed</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912181628255.png" /></p>
<p>Log into FusionInsight HDFS to check the test outcome by using the following command</p>
<p><code>hdfs dfs -cat /tmp/nifitest/nifiHDFS.csv</code></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912181828621.png" /></p>
<h3 id="gethdfs-procedure">GetHDFS Procedure<a class="headerlink" href="#gethdfs-procedure" title="Permanent link">&para;</a></h3>
<ul>
<li>The whole process shown as the following pic:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913092152648.png" /></p>
<ul>
<li>The configuration of processor <strong>GetHDFS</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913093359126.png" /></p>
<div class="codehilite"><pre><span></span>In detail：
1: /usr/nifi/nifi-1.7.1/conf/hdfs-site.xml,/usr/nifi/nifi-1.7.1/conf/core-site.xml
2: Choose KeytabCredentialsService which was completed in previous section
3: /tmp/nifitest/HDFS
</pre></div>

<ul>
<li>The configuration of processor <strong>PutFile</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913092500227.png" /></p>
<div class="codehilite"><pre><span></span>In detail：
1: /home/dataset/HDFS
</pre></div>

<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913092557712.png" /></p>
<ul>
<li>Move the file <code>nifiHDFS.csv</code> into HDFS directory <code>/tmp/nifitest/HDFS</code></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913093946472.png" /></p>
<ul>
<li>Test completed</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913094130431.png" /></p>
<ul>
<li>Log into the FusionInsight HD client side to check the outcome with the directory <code>/home/dataset/HDFS</code></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913094327358.png" /></p>
<h3 id="listhdfs-fetchhdfs-procedure">ListHDFS &amp; FetchHDFS Procedure<a class="headerlink" href="#listhdfs-fetchhdfs-procedure" title="Permanent link">&para;</a></h3>
<ul>
<li>The whole process shown as the following pic:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913101752826.png" /></p>
<ul>
<li>The configuration of processor <strong>ListHDFS</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913102631618.png" /></p>
<div class="codehilite"><pre><span></span>  In detail：
  1. /usr/nifi/nifi-1.7.1/conf/hdfs-site.xml,/usr/nifi/nifi-1.7.1/conf/core-site.xml
  2. KeytabCredentialsService
  3. /tmp/nifitest
</pre></div>

<ul>
<li>The configuration of processor <strong>RouteOnAttribute</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-2018091310313577.png" /></p>
<p>Note: Add one customized property <code>requiredfilenames</code> with the value <code>${filename:matches('sanguo.*')}</code> by clicking on <strong>plus</strong> icon</p>
<div class="codehilite"><pre><span></span>  In detail：
  1. Route to Property name
  2. requiredfilenames
  3. ${filename:matches(&#39;sanguo.*&#39;)}
</pre></div>

<ul>
<li>The relationship configuration between processor <strong>RouteOnAttribute</strong> and upper processor <strong>FetchHDFS</strong> shown as the following pic</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913103920309.png" /></p>
<ul>
<li>The relationship configuration between processor <strong>RouteOnAttribute</strong> and lower processor <strong>FetchHDFS</strong> shown as the following pic</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913103937690.png" /></p>
<ul>
<li>The configuration of processor <strong>FetchHDFS</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913104044399.png" /></p>
<div class="codehilite"><pre><span></span>  In detail：
  1. /usr/nifi/nifi-1.7.1/conf/hdfs-site.xml,/usr/nifi/nifi-1.7.1/conf/core-site.xml
  2. KeytabCredentialsService
</pre></div>

<ul>
<li>The configuration of upper processor <strong>PutFile</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913104357511.png" /></p>
<ul>
<li>The configuration of lower processor <strong>PutFile</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913104436582.png" /></p>
<ul>
<li>Check the files on FusionInsight HDFS by executing command <code>hdfs dfs -ls /tmp/nifitest</code></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913105052385.png" /></p>
<ul>
<li>Test completed</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913105440238.png" /></p>
<p>Log into FusionInsight HD client side to check the outcomes separately</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913105716184.png" /></p>
<h2 id="connecting-nifi-to-hive">Connecting NiFi to Hive<a class="headerlink" href="#connecting-nifi-to-hive" title="Permanent link">&para;</a></h2>
<h3 id="purpose_3">Purpose<a class="headerlink" href="#purpose_3" title="Permanent link">&para;</a></h3>
<p>Configuring NiFi Hive processor to connect FusionInsight HD Hive</p>
<h3 id="prerequisites_3">Prerequisites<a class="headerlink" href="#prerequisites_3" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Installing NiFi 1.7.1 completed</p>
</li>
<li>
<p>Installing FusionInsight HD cluster and its client completed</p>
</li>
<li>
<p>Configuring Kerberos authentication within NiFi completed</p>
</li>
</ul>
<h3 id="hiveconnectionpool-procedure">HiveConnectionPool Procedure<a class="headerlink" href="#hiveconnectionpool-procedure" title="Permanent link">&para;</a></h3>
<ul>
<li>Enter NiFi Web UI site, right click on canvas and click on <strong>Configure</strong> icon</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912174115953.png" /></p>
<ul>
<li>
<p>Click on <strong>plus</strong> icon to add the service</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912174226784.png" /></p>
</li>
<li>
<p>Find <code>HiveConnectionPool</code> and click <strong>ADD</strong></p>
</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913111208294.png" /></p>
<ul>
<li>Click on <strong>gear</strong> icon to configure</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913111250616.png" /></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913111431623.png" /></p>
<div class="codehilite"><pre><span></span>In detail
1: jdbc:hive2://172.21.3.103:24002,172.21.3.101:24002,172.21.3.102:24002/;serviceDiscoveryMode=zooKeeper;principal=hive/hadoop.hadoop.com@HADOOP.COM
2: KeytabCredentialsService
</pre></div>

<ul>
<li>Click on <strong>lightning</strong> icon to enable and save the HiveConnectionPool</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913111645264.png" /></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913111723364.png" /></p>
<ul>
<li>
<p>Completed
  <img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913111757929.png" /></p>
</li>
<li>
<p>Create <code>jaas.conf</code> file which located at directory <code>/usr/nifi/nifi-1.7.1/conf</code> wit the following content</p>
</li>
</ul>
<div class="codehilite"><pre><span></span>Client {
com.sun.security.auth.module.Krb5LoginModule required
useKeyTab=true
keyTab=&quot;/opt/developuser/user.keytab&quot;
principal=&quot;developuser&quot;
useTicketCache=false
storeKey=true
debug=true;
};
</pre></div>

<ul>
<li>Make an adjustment to the <code>bootstrap.conf</code> file by executing following command <code>vi /usr/nifi/nifi-1.7.1/conf/bootstrap.conf</code></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913114735353.png" /></p>
<div class="codehilite"><pre><span></span>java.arg.17=-Djava.security.auth.login.config=/usr/nifi/nifi-1.7.1/conf/jaas.conf
java.arg.18=-Dsun.security.krb5.debug=true
</pre></div>

<ul>
<li>Make an adjustment to the <code>nifi.properties</code> file by executing following command <code>vi /usr/nifi/nifi-1.7.1/conf/nifi.properties</code></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913115135676.png" /></p>
<div class="codehilite"><pre><span></span>nifi.zookeeper.auth.type=sasl
nifi.zookeeper.kerberos.removeHostFromPrincipal=true
nifi.zookeeper.kerberos.removeRealmFromPrincipal=true
</pre></div>

<ul>
<li>Execute the following command to come into the directory of  NiFi Hive related library
 <code>cd /usr/nifi/nifi-1.7.1/work/nar/extensions/nifi-hive-nar-1.7.1.nar-unpacked/META-INF/bundled-dependencies</code></li>
</ul>
<p>Substitute <code>zookeeper-3.5.1.jar</code> which is from FusionInsight HD client side for the original <code>zookeeper-3.4.6.jar</code></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-2018091312062027.png" /></p>
<h3 id="selecthiveql-read-hive-table-procedure">SelectHiveQL read Hive table Procedure<a class="headerlink" href="#selecthiveql-read-hive-table-procedure" title="Permanent link">&para;</a></h3>
<ul>
<li>The whole process shown as the following pic:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-2018091312072896.png" /></p>
<ul>
<li>The configuration of processor <strong>SelectHiveQL</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913120825568.png" /></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913121003311.png" /></p>
<div class="codehilite"><pre><span></span> In detail：
 1: HiveConnectionPool
 2: select * from default.t2
 3. CSV
</pre></div>

<ul>
<li>The configuration of processor <strong>PutFile</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913121155239.png" /></p>
<ul>
<li>Log into FusionInsight cluster to check table <strong>t2</strong> on hive</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-2018091312133394.png" /></p>
<ul>
<li>Completed</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913121452543.png" /></p>
<p>Check the outcome by log into the following directory <code>/home/dataset/HIVE</code></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913121747276.png" /></p>
<h3 id="puthiveql-load-whole-table-procedure">PutHiveQL load whole table Procedure<a class="headerlink" href="#puthiveql-load-whole-table-procedure" title="Permanent link">&para;</a></h3>
<ul>
<li>The whole process shown as the following pic:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913144112926.png" /></p>
<ul>
<li>The configuration of processor <strong>GetFile</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913145536626.png" /></p>
<p><div class="codehilite"><pre><span></span>  In detail：
  1： /home/dataset/
  2: iris.txt
</pre></div>
  Content of <code>iris.txt</code>：</p>
<div class="codehilite"><pre><span></span>  1,5.1,3.5,1.4,0.2,setosa
  2,4.9,3,1.4,0.2,setosa
  3,4.7,3.2,1.3,0.2,setosa
  4,4.6,3.1,1.5,0.2,setosa
  5,5,3.6,1.4,0.2,setosa
  6,5.4,3.9,1.7,0.4,setosa
  7,4.6,3.4,1.4,0.3,setosa
  8,5,3.4,1.5,0.2,setosa
  9,4.4,2.9,1.4,0.2,setosa
  10,4.9,3.1,1.5,0.1,setosa
</pre></div>

<ul>
<li>The configuration of processor <strong>PutHDFS</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913145851111.png" /></p>
<div class="codehilite"><pre><span></span>  In detail：
  1： /usr/nifi/nifi-1.7.1/conf/hdfs-site.xml,/usr/nifi/nifi-1.7.1/conf/core-site.xml
  2： KeytabCredentialsService
  3: /tmp/nifitest/loadhive
</pre></div>

<ul>
<li>The configuration of processor <strong>ReplaceText</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913150058238.png" /></p>
<div class="codehilite"><pre><span></span>  In detail：
  1: CREATE TABLE IF NOT EXISTS iris_createdBy_NiFi ( ID string, sepallength FLOAT, sepalwidth FLOAT, petallength FLOAT, petalwidth FLOAT, species string ) ROW FORMAT DELIMITED FIELDS TERMINATED BY &#39;,&#39; STORED AS TEXTFILE;LOAD DATA INPATH &quot;hdfs:///tmp/nifitest/loadhive/iris.txt&quot; into table iris_createdBy_NiFi;
</pre></div>

<ul>
<li>The configuration of processor <strong>PutHiveQL</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913150303396.png" /></p>
<ul>
<li>Move the data file <code>iris.txt</code> into the following directory <code>/home/dataset/</code> before test</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913150605645.png" /></p>
<ul>
<li>Completed:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913144501255.png" /></p>
<p>Login the HIVE to check the test outcome</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913145436548.png" /></p>
<h3 id="puthiveql-load-the-table-by-rows-procedure">PutHiveQL Load the table by rows Procedure<a class="headerlink" href="#puthiveql-load-the-table-by-rows-procedure" title="Permanent link">&para;</a></h3>
<ul>
<li>The whole process shown as the following pic:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913152255705.png" /></p>
<ul>
<li>The configuration of processor <strong>GetFile</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913154003755.png" /></p>
<div class="codehilite"><pre><span></span>  In detail：
  1： /home/dataset/
  2： iris_add.txt
</pre></div>

<p>Content of <code>iris_add.txt</code>：</p>
<div class="codehilite"><pre><span></span>&quot;11&quot;,5.8,2.8,5.1,2.4,&quot;virginica&quot;
&quot;12&quot;,6.4,3.2,5.3,2.3,&quot;virginica&quot;
&quot;13&quot;,6.5,3,5.5,1.8,&quot;virginica&quot;
&quot;14&quot;,5.7,3,4.2,1.2,&quot;versicolor&quot;
&quot;15&quot;,5.7,2.9,4.2,1.3,&quot;versicolor&quot;
</pre></div>

<ul>
<li>The configuration of processor <strong>SplitText</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913154219909.png" /></p>
<ul>
<li>
<p>There is no change for the configuration of  processor <strong>ExtractText</strong></p>
</li>
<li>
<p>The configuration of processor <strong>ReplaceText</strong></p>
</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913154421612.png" /></p>
<ul>
<li>The configuration of processor <strong>PutHiveQL</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913154500461.png" /></p>
<ul>
<li>Move the data file <code>iris_add.txt</code> into the following directory <code>/home/dataset/</code> before test</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913152411341.png" /></p>
<ul>
<li>Completed：</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-2018091315371178.png" /></p>
<p>Login the HIVE to check the test outcome：</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913153858212.png" /></p>
<h2 id="connecting-nifi-to-hbase">Connecting NiFi to HBase<a class="headerlink" href="#connecting-nifi-to-hbase" title="Permanent link">&para;</a></h2>
<h3 id="purpose_4">Purpose<a class="headerlink" href="#purpose_4" title="Permanent link">&para;</a></h3>
<p>Configuring NiFi HBase processor to connect FusionInsight HD HBase</p>
<h3 id="prerequisites_4">Prerequisites<a class="headerlink" href="#prerequisites_4" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Installing NiFi 1.7.1 completed</p>
</li>
<li>
<p>Installing FusionInsight HD cluster and its client completed</p>
</li>
<li>
<p>Configuring Kerberos authentication within NiFi completed</p>
</li>
</ul>
<h3 id="hbase_1_1_2_clientservice-procedure">HBase_1_1_2_ClientService Procedure<a class="headerlink" href="#hbase_1_1_2_clientservice-procedure" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Move the hbase related configuration file <code>hbase-site.xml</code> which is within the FusionInsight HD client side into the following directory <code>/usr/nifi/nifi-1.7.1/conf</code></p>
</li>
<li>
<p>Execute the following command to come into the directory of  NiFi HBase related library
   <code>cd /usr/nifi/nifi-1.7.1/work/nar/extensions/nifi-hbase_1_1_2-client-service-nar-1.7.1.nar-unpacked/META-INF/bundled-dependencies</code></p>
</li>
</ul>
<p>Substitute <code>zookeeper-3.5.1.jar</code> which is from FusionInsight HD client side for the original <code>zookeeper-3.4.6.jar</code></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913171320336.png" /></p>
<ul>
<li>Enter NiFi Web UI site, right click on canvas and click on <strong>Configure</strong> icon</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912174115953.png" /></p>
<ul>
<li>Click on <strong>plus</strong> icon to add the service</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913160637627.png" /></p>
<ul>
<li>Find <code>HBase_1_1_2_ClientService</code> and click <strong>ADD</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913160755948.png" /></p>
<ul>
<li>Click on <strong>gear</strong> icon to configure</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913160901190.png" /></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913161005377.png" /></p>
<div class="codehilite"><pre><span></span>  In detail：
  1： /usr/nifi/nifi-1.7.1/conf/hbase-site.xml,/usr/nifi/nifi-1.7.1/conf/core-site.xml
  2： KeytabCredentialsService
</pre></div>

<ul>
<li>Click on <strong>lightining</strong> icon to enable and save the <code>HBase_1_1_2_ClientService</code></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913161345190.png" /></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913161410495.png" /></p>
<ul>
<li>Completed</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913161431790.png" /></p>
<h3 id="puthbasejson-load-the-table-procedure">PutHBaseJSON load the table Procedure<a class="headerlink" href="#puthbasejson-load-the-table-procedure" title="Permanent link">&para;</a></h3>
<ul>
<li>The whole process shown as the following pic:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913170925283.png" /></p>
<ul>
<li>The configuration of  processor <strong>GetFile</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913171543197.png" /></p>
<p>Content of <code>hbase_test.csv</code>：
  <div class="codehilite"><pre><span></span>1,5.1,3.5,setosa
2,6.1,3.6,versicolor
3,7.1,3.7,virginica
</pre></div></p>
<ul>
<li>The configuration of processor <strong>InverAvroSchema</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913171824677.png" /></p>
<div class="codehilite"><pre><span></span>  In detail：
  1: flowfile-attribute
  2: csv
  3: false
  4: hbase_test_data
</pre></div>

<ul>
<li>The configuration of  processor <strong>ConvertCSVToAvro</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913172037547.png" /></p>
<ul>
<li>The configuration of  processor <strong>ConvertAvroToJSON</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913172201962.png" /></p>
<ul>
<li>The configuration of  processor <strong>SplitJson</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913172242678.png" /></p>
<ul>
<li>The configuration of  processor <strong>PutHBaseJSON</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913172428386.png" /></p>
<div class="codehilite"><pre><span></span>  In detail:
  1: HBase_1_1_2_ClientService
  2: hbase_test
  3: ${UUID()}
  4: data
</pre></div>

<ul>
<li>Move the data file <code>hbase_test.csv</code> into the following directory <code>/home/dataset/HBASE</code> before test</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913173017728.png" /></p>
<p>In addition, execute following command to create a HBase table</p>
<div class="codehilite"><pre><span></span>hbase shell
create &#39;HBase_test&#39;,&#39;data&#39;
</pre></div>

<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913173220335.png" /></p>
<ul>
<li>Completed：</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913173552752.png" /></p>
<p>Login into the FusionInsight HD cluster to check the outcome:</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913173626203.png" /></p>
<h3 id="gethbase-procedure">GetHbase Procedure<a class="headerlink" href="#gethbase-procedure" title="Permanent link">&para;</a></h3>
<ul>
<li>The whole process shown as the following pic:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913174304746.png" /></p>
<ul>
<li>The configuration of  processor <strong>GetHBase</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913190606193.png" /></p>
<ul>
<li>The configuration of  processor <strong>PutFile</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913191235986.png" /></p>
<ul>
<li>Completed</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913184243562.png" /></p>
<p>Login into the following directory <code>/home/dataset/GetHBase_test</code> to check the test outcome</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180913191317245.png" /></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-2018091319144054.png" /></p>
<h2 id="connecting-nifi-to-spark">Connecting NiFi to Spark<a class="headerlink" href="#connecting-nifi-to-spark" title="Permanent link">&para;</a></h2>
<h3 id="purpose_5">Purpose<a class="headerlink" href="#purpose_5" title="Permanent link">&para;</a></h3>
<p>Configuring NiFi Livy Session processor to connect FusionInsight HD Spark</p>
<h3 id="prerequisites_5">Prerequisites<a class="headerlink" href="#prerequisites_5" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Installing NiFi 1.7.1 completed</p>
</li>
<li>
<p>Installing FusionInsight HD cluster and its client completed</p>
</li>
<li>
<p>Configuring Kerberos authentication within NiFi completed</p>
</li>
<li>
<p>Installing and configuring Apache Livy 0.5.0 (Apache Livy can be installed on test host or any other host as long as they can connect to each other including FusionInsight HD cluster)</p>
<blockquote>
<p>There exist connection instruction between Apache Livy and FusionInsight, please check the FusionInsight ecosystem</p>
</blockquote>
</li>
</ul>
<h3 id="livysessioncontroller-procedure">LivySessionController Procedure<a class="headerlink" href="#livysessioncontroller-procedure" title="Permanent link">&para;</a></h3>
<ul>
<li>Enter NiFi Web UI site, right click on canvas and click on <strong>Configure</strong> icon</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180912174115953.png" /></p>
<ul>
<li>Click on <strong>plus</strong> icon to add the service</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914104314385.png" /></p>
<ul>
<li>Find <code>LivySessionController</code> and click <strong>ADD</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914104402554.png" /></p>
<ul>
<li>Click on <strong>gear</strong> icon to configure</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914104516173.png" /></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914104844258.png" /></p>
<div class="codehilite"><pre><span></span>In detail：
1: 172.21.3.43 (host ip for Apache Livy)
2: 8998 (Livy default port, can be changed)
3: spark
4：KeytabCredentialsService
</pre></div>

<ul>
<li>Click on <strong>plus</strong> icon to add the service</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914105344782.png" /></p>
<ul>
<li>
<p>Find <code>LivySessionController</code> and click <strong>ADD</strong></p>
</li>
<li>
<p>Click on <strong>gear</strong> icon to configure</p>
</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914105516219.png" /></p>
<p>Change the name of Controller as LivySessionController_PySpark</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914105554293.png" /></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914105725237.png" /></p>
<div class="codehilite"><pre><span></span>In detail：
1: 172.21.3.43 (host ip for Apache Livy)
2: 8998 (Livy default port, can be changed)
3: pysaprk
4：KeytabCredentialsService
</pre></div>

<ul>
<li>
<p>Click on <strong>plus</strong> icon to add the service</p>
</li>
<li>
<p>Find <code>LivySessionController</code> and click <strong>ADD</strong></p>
</li>
<li>
<p>Click on <strong>gear</strong> icon to configure</p>
</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914110218855.png" /></p>
<p>Change the name of Controller as LivySessionController_SparkR</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914110258706.png" /></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-2018091411040356.png" /></p>
<div class="codehilite"><pre><span></span>In detail：
1: 172.21.3.43 (host ip for Apache Livy)
2: 8998 (Livy default port, can be changed)
3: sparkr
4：KeytabCredentialsService
</pre></div>

<ul>
<li>Click on <strong>lightining</strong> icon to enable and save the <code>LivySessionController</code>,<code>LivySessionController_PySpark</code>,<code>LivySessionController_SparkR</code></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914110556918.png" /></p>
<ul>
<li>Completed</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914110811125.png" /></p>
<h3 id="spark-sample-procedure">Spark Sample Procedure<a class="headerlink" href="#spark-sample-procedure" title="Permanent link">&para;</a></h3>
<ul>
<li>The whole process shown as the following pic:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-2018091411101510.png" /></p>
<ul>
<li>The configuration of  processor <strong>GetFile</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914111127853.png" /></p>
<div class="codehilite"><pre><span></span>In detail：
1: /home/dataset/sparkTest
2: code1.txt
</pre></div>

<p>Content of <code>code1.txt</code>：
  <div class="codehilite"><pre><span></span>1+2
</pre></div></p>
<ul>
<li>The configuration of  processor <strong>ExtractText</strong></li>
</ul>
<p>Click <strong>plus</strong> icon to add a Property <code>code1</code> with its Value as <code>$</code></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914111426277.png" /></p>
<ul>
<li>The configuration of  processor <strong>ExecuteSparkInteractive</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914112305396.png" /></p>
<div class="codehilite"><pre><span></span>In detail：
1: LivySessionController
2: ${code1}
</pre></div>

<ul>
<li>Move the code file <code>code1.txt</code> into the following directory <code>/home/dataset/sparkTest</code> before test</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914112519376.png" /></p>
<p>Start the Livy server</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914112716361.png" /></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914112911901.png" /></p>
<ul>
<li>Completed：</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914113055754.png" /></p>
<p>Log into the Livy server to check the outcome</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-2018091411321312.png" /></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914113341172.png" /></p>
<h3 id="pyspark-sample-procedure">PySpark Sample Procedure<a class="headerlink" href="#pyspark-sample-procedure" title="Permanent link">&para;</a></h3>
<ul>
<li>The whole process shown as the following pic:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-2018091411101510.png" /></p>
<ul>
<li>The configuration of  processor <strong>GetFile</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914113725733.png" />
  <div class="codehilite"><pre><span></span>In detail：
1: /home/dataset/sparkTest
2: code2.txt
</pre></div></p>
<p>Content of <code>code2.txt</code>：
  <div class="codehilite"><pre><span></span>import random
NUM_SAMPLES = 100000
def sample(p):
  x, y = random.random(), random.random()
  return 1 if x*x + y*y &lt; 1 else 0

count = sc.parallelize(xrange(0, NUM_SAMPLES)).map(sample).reduce(lambda a, b: a + b)
print &quot;Pi is roughly %f&quot; % (4.0 * count / NUM_SAMPLES)
</pre></div></p>
<ul>
<li>The configuration of  processor <strong>ExtractText</strong></li>
</ul>
<p>Click <strong>plus</strong> icon to add a Property <code>code2</code> with its Value as <code>$</code></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914114234899.png" /></p>
<ul>
<li>The configuration of  processor <strong>ExecuteSparkInteractive</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914114342416.png" /></p>
<div class="codehilite"><pre><span></span>In detail：
1: LivySessionController_PySpark
2: ${code2}
</pre></div>

<ul>
<li>Move the code file <code>code2.txt</code> into the following directory <code>/home/dataset/sparkTest</code> before test</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914114447497.png" /></p>
<p>Start the Livy server</p>
<ul>
<li>Completed</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914114625750.png" /></p>
<p>Log into the Livy server to check the outcome</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914114724621.png" /></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914114751933.png" /></p>
<h3 id="sparkr-sample-procedure">SparkR Sample Procedure<a class="headerlink" href="#sparkr-sample-procedure" title="Permanent link">&para;</a></h3>
<ul>
<li>The whole process shown as the following pic:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914141610219.png" /></p>
<p>Note: It's different by comparing to example of former Spark and PySpark</p>
<ul>
<li>
<p>The configuration of  processor <strong>GetFile</strong></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914115049131.png" /></p>
<div class="codehilite"><pre><span></span>In detail：
1: /home/dataset/sparkTest
2: code3.txt
</pre></div>

<p>Content of <code>code3.txt</code>：
<div class="codehilite"><pre><span></span>piR &lt;- function(N) {
    x &lt;- runif(N)
    y &lt;- runif(N)
    d &lt;- sqrt(x^2 + y^2)
    return(4 * sum(d &lt; 1.0) / N)
}

set.seed(5)
cat(&quot;Pi is roughly &quot;,piR(1000000) )
</pre></div></p>
</li>
<li>
<p>The configuration of  processor <strong>ExecuteSparkInteractive</strong></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-2018091414274959.png" />
  <div class="codehilite"><pre><span></span>In detail：
1: /home/dataset/sparkTest
2: code content of code3.txt
</pre></div></p>
</li>
<li>
<p>Move the code file <code>code3.txt</code> into the following directory <code>/home/dataset/sparkTest</code> before test</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914115356781.png" /></p>
<p>Start the Livy server</p>
</li>
<li>
<p>Completed</p>
</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914142925868.png" /></p>
<p>Log into the Livy server to check the outcome</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914115708776.png" /></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914143029264.png" /></p>
<h2 id="connecting-nifi-to-kafka">Connecting NiFi to Kafka<a class="headerlink" href="#connecting-nifi-to-kafka" title="Permanent link">&para;</a></h2>
<h3 id="purpose_6">Purpose<a class="headerlink" href="#purpose_6" title="Permanent link">&para;</a></h3>
<p>Configuring NiFi Kafka processor to connect FusionInsight HD Kafka</p>
<h3 id="prerequisites_6">Prerequisites<a class="headerlink" href="#prerequisites_6" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Installing NiFi 1.7.1 completed</p>
</li>
<li>
<p>Installing FusionInsight HD cluster and its client completed</p>
</li>
<li>
<p>Configuring Kerberos authentication within NiFi completed</p>
</li>
</ul>
<h3 id="gethttp-putkafka-procedure">GetHTTP &amp; PutKafka Procedure<a class="headerlink" href="#gethttp-putkafka-procedure" title="Permanent link">&para;</a></h3>
<ul>
<li>The whole process shown as the following pic:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914143620412.png" /></p>
<ul>
<li>The configuration of  processor <strong>GetHTTP</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914143715990.png" /></p>
<div class="codehilite"><pre><span></span>In detail：
1: http://vincentarelbundock.github.io/Rdatasets/csv/datasets/iris.csv
2: iris.csv
</pre></div>

<ul>
<li>The configuration of  processor <strong>PutKafka</strong>
  <img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914143959710.png" /></li>
</ul>
<div class="codehilite"><pre><span></span>In detail：
1： 172.21.3.102:21005,172.21.3.101:21005,172.21.3.103:21005
2： nifi-kafka-test-demo
3： nifi
</pre></div>

<ul>
<li>Before test：</li>
</ul>
<p>Log into the Kafka component within FusionInsightHD client side and create a Topic <strong>nifi-kafka-test-demo</strong></p>
<div class="codehilite"><pre><span></span>cd /opt/hadoopclient/Kafka/kafka/bin
kafka-topics.sh --create --topic nifi-kafka-test-demo --zookeeper 172.21.3.101:24002,172.21.3.102:24002,172.21.3.103:24002/kafka --partitions 1 --replication-factor 1
</pre></div>

<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914144534988.png" /></p>
<ul>
<li>Completed：</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914144743959.png" /></p>
<p>Log into the kafka component within FusionInsightHD client side to check the outcome</p>
<div class="codehilite"><pre><span></span>cd /opt/hadoopclient/Kafka/kafka/bin
kafka-console-consumer.sh --zookeeper 172.21.3.101:24002,172.21.3.102:24002,172.21.3.103:24002/kafka --topic nifi-kafka-test-demo --from-beginning
</pre></div>

<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914144952375.png" /></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914145017685.png" /></p>
<h3 id="consumekafka_0_11-procedure">ConsumeKafka_0_11 Procedure<a class="headerlink" href="#consumekafka_0_11-procedure" title="Permanent link">&para;</a></h3>
<ul>
<li>The whole process shown as the following pic:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914150029910.png" /></p>
<ul>
<li>The configuration of  processor <strong>ConsumeKafka_0_11</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914145920740.png" /></p>
<div class="codehilite"><pre><span></span>1: 172.21.3.101:21005,172.21.3.102:21005,172.21.3.103:21005
2: PLAINTEXT
3: KeytabCredentialsService
4: Kafka
5: example-metric1
6: DemoConsumer
</pre></div>

<ul>
<li>The configuration of  processor <strong>PutFile</strong></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914150709577.png" /></p>
<ul>
<li>
<p>Before test：</p>
<p>Open the <code>kafka-examples</code> which provided by FusionInsightHD client in eclipse, configure the <code>kafka-examples</code> so that it can be successfully ran and produce messages to kafka</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914151040410.png" /></p>
<p>Note: There must be a producer when testing the NiFi ConsumeKafka_0_11 processor, run <code>NewProducer.java</code> within <code>kafka-examples</code> at first and then start to test NiFi ConsumeKafka_0_11</p>
</li>
<li>
<p>Completed：</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914151449716.png" /></p>
<p>Log into the follow directory <code>/home/dataset/Kafka</code> to check the test outcome</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914151628975.png" /></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914151713272.png" /></p>
</li>
</ul>
<h2 id="connecting-nifi-to-kafka-with-security-mode">Connecting NiFi to Kafka with security mode<a class="headerlink" href="#connecting-nifi-to-kafka-with-security-mode" title="Permanent link">&para;</a></h2>
<h3 id="purpose_7">Purpose<a class="headerlink" href="#purpose_7" title="Permanent link">&para;</a></h3>
<p>Configuring NiFi Kafka processor to connect FusionInsight HD Kafka with port 21007</p>
<h3 id="prerequisites_7">Prerequisites<a class="headerlink" href="#prerequisites_7" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Installing NiFi 1.7.1 completed</p>
</li>
<li>
<p>Installing FusionInsight HD cluster and its client completed</p>
</li>
<li>
<p>Complete NiFi Kerberos configuration</p>
</li>
<li>
<p>nifi host ip: 172.16.2.119, FI HD ip: 172.16.6.10-12</p>
</li>
</ul>
<h3 id="kerberos-authentication-related-operation-steps">Kerberos authentication related operation steps<a class="headerlink" href="#kerberos-authentication-related-operation-steps" title="Permanent link">&para;</a></h3>
<ul>
<li>Create a jaas.conf file in the nifi host <code>/opt</code> path, with the content：
  <div class="codehilite"><pre><span></span>KafkaClient {
com.sun.security.auth.module.Krb5LoginModule required
useKeyTab=true
principal=&quot;developuser@HADOOP.COM&quot;
keyTab=&quot;/opt/user_keytabs/101keytab/user.keytab&quot;
useTicketCache=false
serviceName=&quot;kafka&quot;
storeKey=true
debug=true;
};
</pre></div></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/2019-09-26_141743.png" /></p>
<ul>
<li>
<p>Stop nifi with the command <code>bin/nifi.sh stop</code></p>
</li>
<li>
<p>Find the corresponding kafka client jar package in the kafka client of FI HD，for example: <code>/opt/125_651hdclient/hadoopclient/Kafka/kafka/libs/kafka-clients-1.1.0.jar</code></p>
</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191206160333705.png" /></p>
<ul>
<li>Find the original kafka client jar package on <code>/opt/nifi/nifi-1.7.1/work/nar/extensions/nifi-kafka-1-0-nar-1.7.1.nar-unpacked/META-INF/bundled-dependencies</code> with the name kafka-clients-1.1.0.jar. Rename it  into kafka-clients-0.11.0.1.jar.org. And copy the FI HD corresponding kafka-clients-1.1.0.jar into this directory:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191206160826347.png" /></p>
<ul>
<li>Login to nifi server，use the following command at first to load the environment variables <code>source /opt/hadoopclient/bigdata_env</code>，Then use the following command to load the jvm parameters for java running:<code>export JAVA_TOOL_OPTIONS="-Xmx512m -Xms64m -Djava.security.auth.login.config=/opt/jaas.conf -Dsun.security.krb5.debug=true -Dkerberos.domain.name=hadoop.hadoop.com -Djava.security.krb5.conf=/etc/krb5.conf"</code></li>
</ul>
<p><code>/etc/krb5.conf</code> is the authentication krb5.conf file corresponding to the connecting FI cluster</p>
<p>After completing the above steps, you can use the command <code>java -version</code> to check whether the jvm parameters are successfully loaded:</p>
<p><img alt="" src="../assets/Apache_NiFi/2019-09-26_143425.png" /></p>
<ul>
<li>Use command <code>bin/nifi.sh start</code> to start nifi:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/2019-09-26_143552.png" /></p>
<h3 id="publishkafka_1_0-sample">PublishKafka_1_0 Sample<a class="headerlink" href="#publishkafka_1_0-sample" title="Permanent link">&para;</a></h3>
<ul>
<li>The entire workflow is：</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191206161510376.png" /></p>
<ul>
<li>The configuration of the processor GetHTTP is as follows：</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20180914143715990.png" /></p>
<p><div class="codehilite"><pre><span></span>1: http://vincentarelbundock.github.io/Rdatasets/csv/datasets/iris.csv
2: iris.csv
</pre></div>
- The configuration of the processor PublishKafka_1_0 is as follows：</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191206161820588.png" /></p>
<div class="codehilite"><pre><span></span>1: 172.16.4.121:21007,172.16.4.122:21007,172.16.4.123:21007
2: SASL_PLAINTEXT
3: Kafka
4: KeytabCredentialsService
5: testtopic
6: Guarantee Replicated Delivery
</pre></div>

<ul>
<li>Running the entire workflow：  </li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191206162040660.png" /></p>
<ul>
<li>Check the outcome on kafka:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191206162130884.png" /></p>
<h3 id="consumekafka_1_0-sample">ConsumeKafka_1_0 Sample<a class="headerlink" href="#consumekafka_1_0-sample" title="Permanent link">&para;</a></h3>
<ul>
<li>The entire workflow is：</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/2019-09-26_154306.png" /></p>
<ul>
<li>The configuration of the processor ConsumeKafka_1_0 is as follows：</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191206162716591.png" /></p>
<div class="codehilite"><pre><span></span>1: 172.16.4.121:21007,172.16.4.122:21007,172.16.4.123:21007
2: SASL_PLAINTEXT
3: kafka
4: KeytabCredentialsService
5: testtopic
6: Demo
</pre></div>

<ul>
<li>The configuration of the processor PutFile is as follows：</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/2019-09-26_154859.png" /></p>
<ul>
<li>Running the entire workflow：  </li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191206162445287.png" /></p>
<ul>
<li>Use command on Kafka client to insert some data:
  <code>./bin/kafka-console-producer.sh --broker-list 172.16.4.121:21007,172.16.4.122:21007,172.16.4.123:21007 --topic testtopic --producer.config config/producer.properties</code></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191206162954392.png" /></p>
<ul>
<li>Login to nifi host <code>/opt/nifikafka21007</code> to check the outcome</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191206163231548.png" /></p>
<h2 id="nifi-connect-to-solr-with-security-mode">NiFi connect to Solr with security mode<a class="headerlink" href="#nifi-connect-to-solr-with-security-mode" title="Permanent link">&para;</a></h2>
<h3 id="test-environmental-description">Test environmental description<a class="headerlink" href="#test-environmental-description" title="Permanent link">&para;</a></h3>
<p>FI HD: 172.16.4.121-123
NIFI: 172.17.2.124</p>
<h3 id="fi-hd-related-configuration">FI HD related configuration:<a class="headerlink" href="#fi-hd-related-configuration" title="Permanent link">&para;</a></h3>
<ol>
<li>Refer to the solr section of the product documentation and do the following configuration (optional)：</li>
</ol>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220142400497.png" /></p>
<ol>
<li>Use the following curl command to create a collection named nifi_test on FusionInsight Solr</li>
</ol>
<p><code>curl --negotiate -k -v -u : "https://172.16.4.122:21101/solr/admin/collections?action=CREATE&amp;name=nifi_test&amp;collection.configName=confWithSchema&amp;numShards=3&amp;replicationFactor=1"</code></p>
<ol>
<li>Log in to the fusioninsight client, log in to kadmin as shown in the screenshot below, and add the HTTP service principal of 3 nodes.</li>
</ol>
<p>Note 1: Follow the steps shown as the pic below</p>
<p>Note 2: The initial password is Admin@123 when executing the <code>kadmin –p kadmin/admin</code> command, the new password must be kept in mind after modification</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191219213241757.png" /></p>
<ol>
<li>Log in to the oracle official website to obtain JCE, and adapt it to the FI HD cluster</li>
</ol>
<p>Explanation: Because kerberos checksum encryption and decryption uses a key length that far beyond the default secure character length of jre, you need to download the Java Cryptography Extension (JCE) from the java official website: <a href="https://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html">https://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html</a>, then extract it to <code>%JAVA_HOME%/jre/lib/security</code> and replace the corresponding file.</p>
<p>The specific operation is as follows: decompress the downloaded jce, and copy the two decompressed jar packages <code>US_export_policy.jar</code> and<code>local_policy.jar</code> to <code>/opt/huawei/Bigdata/common/runtime0/jdk-8u201/jre/lib/security/</code>path of every FI HD node(172.16.4.121,172.16.4.122,172.16.4.123), and <strong>restart</strong> the entire solr service</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220154656535.png" /></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220154755973.png" /></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220154846833.png" /></p>
<h3 id="nifi-related-configuration">NiFi related configuration:<a class="headerlink" href="#nifi-related-configuration" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>nifi.properties file configuration changes：</p>
<ul>
<li>web properties part：</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191219181722253.png" /></p>
<ul>
<li>kerberos part：</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191219182014778.png" /></p>
<ul>
<li>Add sasl configuration：</li>
</ul>
<div class="codehilite"><pre><span></span>nifi.zookeeper.auth.type=sasl
nifi.zookeeper.kerberos.removeHostFromPrincipal=true
nifi.zookeeper.kerberos.removeRealmFromPrincipal=true
</pre></div>

</li>
<li>
<p>bootstrap.conf file configuration changes：</p>
</li>
</ol>
<p>Add one jvm parameter: <code>java.arg.17=-Djava.security.auth.login.config=/opt/jaas.conf</code></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191219182424298.png" /></p>
<p>The jaas.conf content is:</p>
<div class="codehilite"><pre><span></span>Client {
com.sun.security.auth.module.Krb5LoginModule required
useKeyTab=true
principal=&quot;developuser@HADOOP.COM&quot;
keyTab=&quot;/opt/user.keytab&quot;
useTicketCache=false
storeKey=true
debug=true;
};
</pre></div>

<ol>
<li>Because it is connected to solr, we need to find the path of nifi's solr dependency package directory, taking my machine as an example, it is：<code>/opt/nifi/nifi-1.7.1/work/nar/extensions/nifi-solr-nar-1.7.1.nar-unpacked/META-INF/bundled-dependencies</code>
  <img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191219183059648.png" /></li>
</ol>
<p>Rename the original zookeeper-3.4.6.jar to zookeeper-3.4.6.jar.org, and copy the FI HD corresponding zookeeper-3.5.1.jar into this directory</p>
<h3 id="ssl-certificate-related-configuration">SSL certificate related configuration<a class="headerlink" href="#ssl-certificate-related-configuration" title="Permanent link">&para;</a></h3>
<p>Note: Because the FI HD solr is deployed in a secure mode, when using the rest interface to interact, it is required to pass the SSL layer authentication. You need to create a corresponding certificate (truststore). After completion, you need to use spnego to interact with the cluster solr. The following describes two methods of obtaining authentication certificates, which correspond to the two connect methods of Solr, Cloud and Standard, respectively.</p>
<ol>
<li>
<p>huawei-huawei certificate</p>
<ul>
<li>Login to the Linux background (requires openssl), use the following command: <code>openssl s_client -host 172.16.4.122 -port 21101 -prexit -showcerts\</code></li>
</ul>
<p>There will be three segments of certificates: huawei-huawei, huawei-FusionInsight, FusionInsight-172.16.4.122. We need the huawei-huawei part.</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220152730226.png" /></p>
<p>Copy part of huawei-huawei to a new file: <code>/opt/ssltest/huawei-huawei.pem</code></p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191219190446576.png" /></p>
<ul>
<li>Use the command <code>keytool -import -alias gca -file /opt/ssltest/huawei-huawei.pem -keystore /opt/ssltest/truststore</code> to add the content of the<code>huawei-huawei.pem</code> certificate generated in the previous step to <code>/opt/ssltest/truststore</code> file, the password entered during the process is <code>changeit</code>, enter <code>yes</code> at the last step</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191219190618418.png" /></p>
</li>
<li>
<p>Certificate chain，It is known from the previous step that a certificate chain will be generated, which contains three segments. This step is to generate a new truststore_huawei file for the entire certificate chain(all three segements).</p>
<ul>
<li>Use the following command <code>echo "" | openssl s_client -host 172.16.4.122 -port 21101 -showcerts | awk '/BEGIN CERT/ {p=1} ; p==1; /END CERT/ {p=0}' &gt; /opt/ssltest/allcerts122.pem</code> to redirect the entire certificate chain into the following pem file: <code>/opt/ssltest/allcerts122.pem</code></li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191219191227143.png" /></p>
<ul>
<li>Use the command <code>keytool -import -alias gca -file /opt/ssltest/allcerts122.pem -keystore /opt/ssltest/truststore_chain</code>to add the content of the <code>allcerts122.pem</code> certificate generated in the previous step to <code>/opt/ssltest/truststore_chain</code> file，he password entered during the process is <code>changeit</code>, enter <code>yes</code> at the last step</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191219191354715.png" /></p>
</li>
</ol>
<h3 id="nifi-putsolrcontentstream-standard-mode-configuration">NiFi PutSolrContentStream STANDARD mode Configuration<a class="headerlink" href="#nifi-putsolrcontentstream-standard-mode-configuration" title="Permanent link">&para;</a></h3>
<p>Note: Standard mode directly connects to Solr service through HTTPS. SSL requires certificate chain truststore_chain</p>
<ol>
<li>Configure KeytabCredentialsService</li>
</ol>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191219183726192.png" /></p>
<ol>
<li>Configure StandardRestrictedSSLContextService</li>
</ol>
<p>Note: Rename this contoller to CHAINStandardRestrictedSSLContextService for easy differentiation</p>
<div class="codehilite"><pre><span></span>1.  /opt/ssltest/truststore_chain
2.  changeit
3.  JKS
4.  TLS
</pre></div>

<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-2019122010591137.png" /></p>
<ol>
<li>The entire PutSolrContentStream workflow is shown in Figure：</li>
</ol>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191219211224328.png" /></p>
<ol>
<li>GenerateFlowFile Configuration:</li>
</ol>
<div class="codehilite"><pre><span></span>{
  &quot;id&quot;:&quot;${UUID()}&quot;,
  &quot;message&quot;:&quot;The time is ${now()}&quot;
}
</pre></div>

<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220105355589.png" /></p>
<ol>
<li>PutSolrContentStream Configuration：</li>
</ol>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220105801286.png" /></p>
<div class="codehilite"><pre><span></span>1. Standard
2. https://172.16.4.122:21101/solr/nifi_test
3. nifi_test
4. KeytabCredentialsService
5. CHAINStandardRestrictedSSLContextService
</pre></div>

<ol>
<li>Start the entire workflow</li>
</ol>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220111653299.png" /></p>
<ol>
<li>Log in to the Cluster Manager interface and log in to the solradmin webUI to view the results：</li>
</ol>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220111807584.png" /></p>
<h3 id="nifi-putsolrcontentstream-cloud-mode-configuration">NiFi PutSolrContentStream CLOUD mode Configuration<a class="headerlink" href="#nifi-putsolrcontentstream-cloud-mode-configuration" title="Permanent link">&para;</a></h3>
<p>Note: Cloud mode first connects to the cluster zookeeper service and then reads the solr connection information to connect to the solr service. SSL only requires the huawei-huawei certificate truststore.</p>
<ol>
<li>Configure KeytabCredentialsService</li>
</ol>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191219183726192.png" /></p>
<ol>
<li>Configure StandardRestrictedSSLContextService</li>
</ol>
<div class="codehilite"><pre><span></span>1.  /opt/ssltest/truststore
2.  changeit
3.  JKS
4.  TLS
</pre></div>

<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191219192020162.png" /></p>
<ol>
<li>
<p>The entire PutSolrContentStream workflow is shown in Figure：</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191219211224328.png" /></p>
</li>
<li>
<p>GenerateFlowFile Configuration：</p>
<div class="codehilite"><pre><span></span>{
    &quot;id&quot;:&quot;${UUID()}&quot;,
    &quot;message&quot;:&quot;The time is ${now()}&quot;
}
</pre></div>

<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220105355589.png" /></p>
</li>
<li>
<p>PutSolrContentStream Configuration:</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220112935334.png" /></p>
<div class="codehilite"><pre><span></span>1. Cloud
2. 172.16.4.122:24002/solr
3. nifi_test
4. KeytabCredentialsService
5. StandardRestrictedSSLContextService
</pre></div>

</li>
<li>
<p>Start the entire workflow</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220111653299.png" /></p>
</li>
<li>
<p>Log in to the Cluster Manager interface and log in to the solradmin webUI to view the results：</p>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220111807584.png" /></p>
</li>
</ol>
<h3 id="nifi-querysolr-configuration">NIFI QuerySolr Configuration<a class="headerlink" href="#nifi-querysolr-configuration" title="Permanent link">&para;</a></h3>
<p>Note: QuerySolr can be connected to Solr in either Standard or Cloud mode. The difference is that the requested Solor Location and SSL certificate configuration are different. The others are the same.</p>
<ul>
<li>The entire PutSolrContentStream workflow is shown in Figure：</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220113909965.png" /></p>
<ul>
<li>QuerySolr Standard mode Configuration:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220114106290.png" /></p>
<div class="codehilite"><pre><span></span>1. Standard
2. https://172.16.4.122:21101/solr/nifi_test
3. nifi_test
4. KeytabCredentialsService
5. CHAINStandardRestrictedSSLContextService
</pre></div>

<ul>
<li>QuerySolr Cloud mode Configuration:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220115356470.png" /></p>
<div class="codehilite"><pre><span></span>1. Cloud
2. 172.16.4.122:24002/solr
3. nifi_test
4. KeytabCredentialsService
5. StandardRestrictedSSLContextService
</pre></div>

<ul>
<li>PutFile Configuration:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220114249340.png" /></p>
<ul>
<li>Start the entire workflow:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220114623496.png" /></p>
<ul>
<li>Log in to the background to view the results:</li>
</ul>
<p><img alt="" src="../assets/Apache_NiFi/markdown-img-paste-20191220114907298.png" /></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../Data_Analysis/RapidMiner/" title="8.2.001 C80" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                8.2.001 <--> C80
              </span>
            </div>
          </a>
        
        
          <a href="../Informatica_PowerCenter/" title="10.2.0 6.5" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                10.2.0 <--> 6.5
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/fusioninsight" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.8e03edeb.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../js/jq.js"></script>
      
        <script src="../../js/extra.js"></script>
      
        <script src="../../js/baidu-tongji.js"></script>
      
    
  </body>
</html>